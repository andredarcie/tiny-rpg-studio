<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tiny RPG Studio</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=20260204-4">
    <style>
        #game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #000;
            overflow: hidden;
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D8S0K3NWFV"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-D8S0K3NWFV');
    </script>
</head>
<body>
    <div class="app">
        <main>
            <div class="tabs">
                <p class="tabs-title" data-text-key="app.title"></p>
                <div class="tabs-links">
                    <button class="tab-button active" type="button" data-tab="game" aria-selected="true" data-text-key="tabs.game"></button>
                    <button class="tab-button" type="button" data-tab="editor" aria-selected="false" data-text-key="tabs.editor"></button>
                    <button id="btn-reset" class="tab-action-button" type="button" data-text-key="buttons.reset" data-aria-label-key="aria.reset"></button>
                </div>
            </div>

            <div class="tab-content active" id="tab-game">
                <div class="game-container" id="game-container">
                    <div id="combat-indicator" class="combat-indicator" aria-live="polite" aria-atomic="true"></div>
                    <div class="game-screen">
                        <canvas id="game-canvas" width="128" height="152"></canvas>
                        <div id="screen-flash" class="screen-flash" aria-hidden="true"></div>
                    </div>
                    <button
                        id="touch-controls-toggle"
                        class="touch-controls-toggle"
                        type="button"
                        aria-controls="mobile-touch-pad"
                        aria-expanded="false"
                        data-text-key="touchControls.show"
                    ></button>
                    <div id="mobile-touch-pad" class="game-touch-pad" aria-hidden="true">
                        <button
                            id="touch-controls-hide"
                            class="touch-controls-hide"
                            type="button"
                            aria-label=""
                            data-text-key="touchControls.hide"
                            data-aria-label-key="touchControls.hide"
                        ></button>
                        <button class="pad-button pad-up" data-direction="up" aria-label="" data-aria-label-key="touchControls.upLabel"></button>
                        <div class="pad-middle-row">
                            <button class="pad-button pad-left" data-direction="left" aria-label="" data-aria-label-key="touchControls.leftLabel"></button>
                            <button class="pad-button pad-center" tabindex="-1" aria-hidden="true"></button>
                            <button class="pad-button pad-right" data-direction="right" aria-label="" data-aria-label-key="touchControls.rightLabel"></button>
                        </div>
                        <button class="pad-button pad-down" data-direction="down" aria-label="" data-aria-label-key="touchControls.downLabel"></button>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-editor">
                <div class="editor-layout">
                    <div class="editor-left">
                        <div class="editor-section editor-section--tiles" data-mobile-panel="tiles">
                            <details open>
                                <summary data-text-key="sections.tiles"></summary>
                                <div class="tiles-panel">
                                    <p id="tile-preset-summary" class="tile-preset-summary"></p>
                                    <div id="tile-list" class="tile-list"></div>
                                </div>
                            </details>
                        </div>

                        <div class="editor-section editor-section--world" data-mobile-panel="world">
                            <details open>
                                <summary data-text-key="sections.world"></summary>
                                <div class="world-panel">
                                    <div id="world-grid" class="world-grid"></div>
                                </div>
                            </details>
                        </div>

                        <div class="editor-section editor-section--objects" data-mobile-panel="objects">
                            <details open>
                                <summary data-text-key="sections.objects"></summary>
                                <div class="objects-panel">
                                    <div id="object-types" class="object-types"></div>
                                    <div id="objects-list" class="objects-list"></div>
                                </div>
                            </details>
                        </div>

                    </div>

                    <div class="editor-center">
                        <div class="editor-section editor-section--map">
                            <div class="editor-map-wrapper">
                                <button
                                    type="button"
                                    class="map-nav-button map-nav-button--up"
                                    data-direction="up"
                                    data-aria-label-key="editor.mapNav.up"
                                    data-title-key="editor.mapNav.up"
                                ></button>
                                <button
                                    type="button"
                                    class="map-nav-button map-nav-button--down"
                                    data-direction="down"
                                    data-aria-label-key="editor.mapNav.down"
                                    data-title-key="editor.mapNav.down"
                                ></button>
                                <button
                                    type="button"
                                    class="map-nav-button map-nav-button--left"
                                    data-direction="left"
                                    data-aria-label-key="editor.mapNav.left"
                                    data-title-key="editor.mapNav.left"
                                ></button>
                                <button
                                    type="button"
                                    class="map-nav-button map-nav-button--right"
                                    data-direction="right"
                                    data-aria-label-key="editor.mapNav.right"
                                    data-title-key="editor.mapNav.right"
                                ></button>
                                <canvas id="editor-canvas" width="384" height="384"></canvas>
                            </div>
                            <div class="editor-mobile-nav" aria-label="" data-aria-label-key="editor.mobileNav.label">
                                <button type="button" class="editor-mobile-nav-button active" data-mobile-target="tiles" data-title-key="editor.mobileNav.tiles" data-aria-label-key="editor.mobileNav.tiles">üß±</button>
                                <button type="button" class="editor-mobile-nav-button" data-mobile-target="world" data-title-key="editor.mobileNav.world" data-aria-label-key="editor.mobileNav.world">üó∫Ô∏è</button>
                                <button type="button" class="editor-mobile-nav-button" data-mobile-target="objects" data-title-key="editor.mobileNav.objects" data-aria-label-key="editor.mobileNav.objects">üéí</button>
                                <button type="button" class="editor-mobile-nav-button" data-mobile-target="npcs" data-title-key="editor.mobileNav.npcs" data-aria-label-key="editor.mobileNav.npcs">üßç</button>
                                <button type="button" class="editor-mobile-nav-button" data-mobile-target="enemies" data-title-key="editor.mobileNav.enemies" data-aria-label-key="editor.mobileNav.enemies">üëπ</button>
                                <button type="button" class="editor-mobile-nav-button" data-mobile-target="project" data-title-key="editor.mobileNav.project" data-aria-label-key="editor.mobileNav.project">üìÅ</button>
                            </div>
                        </div>
                    </div>

                    <div class="editor-right">
                        <div class="editor-section editor-section--npcs" data-mobile-panel="npcs">
                            <details open>
                                <summary data-text-key="sections.npcs"></summary>
                                <div class="npcs-panel">
                                    <div class="npc-variant-selector">
                                        <div class="npc-variant-buttons">
                                            <button type="button" class="npc-variant-button active" data-npc-variant-filter="human" aria-pressed="true" data-text-key="npc.variant.human"></button>
                                            <button type="button" class="npc-variant-button" data-npc-variant-filter="elf" aria-pressed="false" data-text-key="npc.variant.elf"></button>
                                            <button type="button" class="npc-variant-button" data-npc-variant-filter="dwarf" aria-pressed="false" data-text-key="npc.variant.dwarf"></button>
                                            <button type="button" class="npc-variant-button" data-npc-variant-filter="fixed" aria-pressed="false" data-text-key="npc.variant.fixed"></button>
                                        </div>
                                    </div>
                                    <div id="npcs-list" class="npcs-list"></div>
                                    <div class="npc-editor" hidden>
                                        <label for="npc-text" data-text-key="npc.dialog.defaultLabel"></label>
                                        <textarea id="npc-text" data-placeholder-key="npc.dialog.placeholder"></textarea>
                                        <div class="npc-reward-group">
                                            <label for="npc-reward-variable" data-text-key="npc.reward.defaultLabel"></label>
                                            <select id="npc-reward-variable"></select>
                                        </div>
                                        <div class="npc-conditional-toggle">
                                            <button type="button" id="btn-toggle-npc-conditional" aria-expanded="false" aria-controls="npc-conditional-section" data-text-key="npc.toggle.create"></button>
                                        </div>
                                        <div id="npc-conditional-section" class="npc-conditional-section" hidden>
                                            <div class="npc-conditional-group">
                                                <label for="npc-conditional-variable" data-text-key="npc.conditional.variableLabel"></label>
                                                <select id="npc-conditional-variable"></select>
                                                <label for="npc-conditional-text" data-text-key="npc.conditional.textLabel"></label>
                                                <textarea id="npc-conditional-text" data-placeholder-key="npc.conditional.placeholder"></textarea>
                                            </div>
                                            <div class="npc-reward-group npc-conditional-reward">
                                                <label for="npc-conditional-reward-variable" data-text-key="npc.conditional.rewardLabel"></label>
                                                <select id="npc-conditional-reward-variable"></select>
                                            </div>
                                        </div>
                                        <button id="npc-delete" data-text-key="npc.delete"></button>
                                    </div>
                                </div>
                            </details>
                        </div>

                        <div class="editor-section editor-section--enemies" data-mobile-panel="enemies">
                            <details open>
                                <summary data-text-key="sections.enemies"></summary>
                                <div class="enemies-panel">
                                    <div id="enemy-types" class="enemy-types"></div>
                                    <div id="enemies-list" class="enemies-list"></div>
                                </div>
                            </details>
                        </div>

                        <div class="editor-section editor-section--project" data-mobile-panel="project">
                            <details open>
                                <summary data-text-key="sections.project"></summary>
                                <div class="project-actions">
                                    <div id="project-variables-container" class="project-variables">
                                        <button id="project-variables-toggle" class="project-variables__toggle" type="button"></button>
                                        <div id="project-variable-usage-list" class="project-variables__list"></div>
                                    </div>
                                    <div id="project-skills-container" class="project-variables project-variables--skills">
                                        <button id="project-skills-toggle" class="project-variables__toggle" type="button"></button>
                                        <div id="project-skills-list" class="project-variables__list project-skills__list"></div>
                                    </div>
                                    <div id="project-test-container" class="project-variables project-test">
                                        <button id="project-test-toggle" class="project-variables__toggle project-test__toggle" type="button"></button>
                                        <div id="project-test-panel" class="project-test__panel">
                                            <p class="project-test__hint" data-text-key="project.test.hint"></p>
                                            <label class="project-test__field">
                                                <span data-text-key="project.test.startLevel"></span>
                                                <select id="project-test-start-level"></select>
                                            </label>
                                            <label class="project-test__field project-test__checkbox">
                                                <input type="checkbox" id="project-test-god-mode">
                                                <span data-text-key="project.test.godMode"></span>
                                            </label>
                                            <div class="project-test__skills">
                                                <div class="project-test__skills-title" data-text-key="project.test.skills"></div>
                                                <div id="project-test-skill-list" class="project-test__skill-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Paleta Customizada -->
                                    <div id="project-palette-container" class="project-variables project-palette">
                                        <button id="project-palette-toggle" class="project-variables__toggle project-palette__toggle" type="button"></button>
                                        <div id="project-palette-panel" class="project-palette__panel" hidden>
                                            <div class="palette-header">
                                                <p class="palette-description" data-text-key="project.paletteDescription"></p>
                                                <button
                                                    id="palette-reset-button"
                                                    class="palette-reset-btn"
                                                    data-text-key="project.paletteReset"
                                                    title="Reset to PICO-8 colors"
                                                ></button>
                                            </div>
                                            <div id="palette-grid" class="palette-grid"></div>
                                        </div>
                                    </div>
                                    <!-- Color Picker Modal -->
                                    <div id="color-picker-modal" class="color-picker-modal" hidden>
                                        <div class="color-picker-content">
                                            <div class="color-picker-panel">
                                                <div class="color-picker-header">
                                                    <h3 data-text-key="project.colorPickerTitle"></h3>
                                                    <span id="color-picker-index" class="color-index-label"></span>
                                                </div>
                                                <div class="color-picker-preview">
                                                    <div class="color-preview-box">
                                                        <div id="color-preview-current" class="color-preview-row">
                                                            <div class="color-preview-meta">
                                                                <span class="color-preview-label" data-text-key="project.colorCurrent"></span>
                                                                <span id="color-preview-current-value" class="color-preview-value"></span>
                                                            </div>
                                                            <div class="color-preview-swatch"></div>
                                                        </div>
                                                        <div id="color-preview-new" class="color-preview-row">
                                                            <div class="color-preview-meta">
                                                                <span class="color-preview-label" data-text-key="project.colorNew"></span>
                                                                <span id="color-preview-new-value" class="color-preview-value"></span>
                                                            </div>
                                                            <div class="color-preview-swatch"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input
                                                    type="color"
                                                    id="color-picker-input"
                                                    class="color-picker-input"
                                                />
                                                <div class="color-picker-actions">
                                                    <button
                                                        id="color-picker-cancel"
                                                        class="btn-secondary"
                                                        data-text-key="project.colorCancel"
                                                    ></button>
                                                    <button
                                                        id="color-picker-confirm"
                                                        class="btn-primary"
                                                        data-text-key="project.colorConfirm"
                                                    ></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="project-field">
                                        <span data-text-key="project.titleLabel"></span>
                                        <input type="text" id="game-title" data-placeholder-key="project.titlePlaceholder" maxlength="18">
                                    </label>
                                    <label class="project-field">
                                        <span data-text-key="project.authorLabel"></span>
                                        <input type="text" id="game-author" data-placeholder-key="project.authorPlaceholder" maxlength="18">
                                    </label>
                                    <label class="project-field project-field--language">
                                        <span data-text-key="project.languageLabel"></span>
                                        <select id="language-select">
                                            <option value="pt-BR" data-text-key="language.option.ptBR"></option>
                                            <option value="en-US" data-text-key="language.option.enUS"></option>
                                        </select>
                                    </label>
                                    <p class="project-share-hint" data-text-key="project.shareHint"></p>
                                    <button id="btn-generate-url" data-text-key="project.generateUrl"></button>
                                    <label class="project-field project-field--share-url">
                                        <span data-text-key="project.shareUrlLabel"></span>
                                        <input id="project-share-url" type="text" readonly spellcheck="false" autocomplete="off" inputmode="url">
                                    </label>
                                    <button id="btn-generate-html" data-text-key="project.generateHTML"></button>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- Carregar m√≥dulos na ordem correta -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import {
            addDoc,
            collection,
            getFirestore,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAQVJVjDKFB7GBKMBUGJ5g5Gj3dGzPIdK8",
            authDomain: "tiny-rpg-studio.firebaseapp.com",
            projectId: "tiny-rpg-studio",
            storageBucket: "tiny-rpg-studio.firebasestorage.app",
            messagingSenderId: "985096774156",
            appId: "1:985096774156:web:71802842fd9328f6ae0429",
            measurementId: "G-B56JRXPGED"
        };

        window.TinyRPGFirebaseConfig = firebaseConfig;
        window.TinyRPGFirebaseCollection = "shareUrls";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.TinyRPGFirebaseApp = app;
        window.TinyRPGFirebaseDb = db;
        window.TinyRPGFirebaseFirestore = { addDoc, collection, serverTimestamp };

        try {
            if (firebaseConfig.measurementId) {
                getAnalytics(app);
            }
        } catch (error) {
            console.warn('[TinyRPG] Firebase analytics unavailable.', error);
        }
    </script>
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
